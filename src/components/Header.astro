---
import { getLangFromUrl, useTranslations } from "../i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<header class="w-full fixed h-15 backdrop-blur-md font-mono z-10">
  <div class="h-full max-w-[80%] mx-auto flex items-center justify-between">
    <h2
      class="font-black text-lg lg:text-xl flex items-center justify-start basis-44 lg:basis-48"
    >
      <a
        class="hover:bg-linear-to-r hover:from-[#667eea] hover:to-[#764ba2] hover:bg-clip-text hover:text-transparent py-2"
        href={`/${lang}#home`}
      >
        Jonathan Salazar
      </a>
    </h2>
    <div class="md:hidden">
      <button id="sidebar-icon" aria-label="Open navigation menu">
        <svg
          class="w-8 h-8"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </div>

    <!-- Desktop Navigation -->
    <ul
      class="hidden md:flex items-center gap-6 lg:gap-9 px-1 py-2 font-medium text-sm lg:text-base"
    >
      <li>
        <a class="nav-link p-2" href={`/${lang}#home`}>{t("nav.home")}</a>
      </li>
      <li>
        <a class="nav-link p-2" href={`/${lang}#about`}>{t("nav.about")}</a>
      </li>
      <li>
        <a class="nav-link p-2" href={`/${lang}#portfolio`}
          >{t("nav.portfolio")}</a>
      </li>
      <li>
        <a class="nav-link p-2" href={`/${lang}#contact`}>{t("nav.contact")}</a>
      </li>
    </ul>

    <!-- Language Switcher (Desktop) -->
    <div class="hidden md:flex gap-2 items-center ml-4">
      <a
        href={`/es${Astro.url.hash || "#home"}`}
        class:list={[
          "px-2 py-1 rounded hover:bg-purple-500/20 transition-colors",
          lang === "es" && "font-bold text-purple-400 bg-purple-500/10",
        ]}
      >
        ES
      </a>
      <span class="text-gray-500">|</span>
      <a
        href={`/en${Astro.url.hash || "#home"}`}
        class:list={[
          "px-2 py-1 rounded hover:bg-purple-500/20 transition-colors",
          lang === "en" && "font-bold text-purple-400 bg-purple-500/10",
        ]}
      >
        EN
      </a>
    </div>
  </div>
</header>

<!-- Mobile Sidebar -->
<div
  id="sidebar"
  role="navigation"
  class="font-mono fixed top-0 right-0 w-64 h-full bg-linear-to-br from-blue-950 to-slate-950 border-l border-l-slate-800 backdrop-blur-md transform translate-x-full transition-transform duration-300 ease-in-out z-50 md:hidden"
>
  <div class="py-6">
    <button
      id="close-sidebar"
      aria-label="Close navigation menu"
      class="mb-8 pl-6"
    >
      <svg
        class="w-8 h-8"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>

    <!-- Mobile Navigation Links -->
    <ul class="flex flex-col gap-3 font-medium mb-6">
      <li>
        <a
          class="hover:bg-white/10 focus:bg-white/15 py-2 pl-8 block w-full"
          href={`/${lang}#home`}>{t("nav.home")}</a
        >
      </li>
      <li>
        <a
          class="hover:bg-white/10 focus:bg-white/15 py-2 pl-8 block w-full"
          href={`/${lang}#about`}>{t("nav.about")}</a
        >
      </li>
      <li>
        <a
          class="hover:bg-white/10 focus:bg-white/15 py-2 pl-8 block w-full"
          href={`/${lang}#portfolio`}>{t("nav.portfolio")}</a
        >
      </li>
      <li>
        <a
          class="hover:bg-white/10 focus:bg-white/15 py-2 pl-8 block w-full"
          href={`/${lang}#contact`}>{t("nav.contact")}</a
        >
      </li>
    </ul>

    <!-- Language Switcher (Mobile) -->
    <div class="border-t border-gray-700 pt-4 px-8">
      <p class="text-xs text-gray-400 mb-3">Idioma / Language</p>
      <div class="flex gap-3">
        <a
          href={`/es${Astro.url.hash || "#home"}`}
          class:list={[
            "px-3 py-2 rounded text-sm hover:bg-white/10 transition-colors flex-1 text-center",
            lang === "es" && "font-bold bg-purple-500/20 text-purple-300",
          ]}
        >
          Espa√±ol
        </a>
        <a
          href={`/en${Astro.url.hash || "#home"}`}
          class:list={[
            "px-3 py-2 rounded text-sm hover:bg-white/10 transition-colors flex-1 text-center",
            lang === "en" && "font-bold bg-purple-500/20 text-purple-300",
          ]}
        >
          English
        </a>
      </div>
    </div>
  </div>
</div>

<script>
  const sidebarIcon = document.getElementById("sidebar-icon");
  const sidebar = document.getElementById("sidebar");
  const closeSidebar = document.getElementById("close-sidebar");

  // Abrir sidebar
  sidebarIcon?.addEventListener("click", () => {
    sidebar?.classList.remove("translate-x-full");
  });

  // Cerrar sidebar
  closeSidebar?.addEventListener("click", () => {
    sidebar?.classList.add("translate-x-full");
  });

  // Cerrar al hacer click en los enlaces
  const sidebarLinks = sidebar?.querySelectorAll("a");
  sidebarLinks?.forEach((link) => {
    link.addEventListener("click", () => {
      sidebar?.classList.add("translate-x-full");
    });
  });

  // Cerrar al hacer click fuera del sidebar
  document.addEventListener("click", (e) => {
    const target = e.target as HTMLElement;
    if (!sidebar?.contains(target) && !sidebarIcon?.contains(target)) {
      sidebar?.classList.add("translate-x-full");
    }
  });
</script>

<style>
  .nav-link {
    position: relative;
    display: inline-block;
    transition: color 0.3s ease;
  }

  /* Efecto de outline que se rellena en sentido horario */
  .nav-link::before {
    content: "";
    position: absolute;
    inset: -2px;
    border: 2px solid transparent;
    border-radius: 4px;
    background:
      linear-gradient(0deg, #667eea 0%, #764ba2 100%) border-box,
      linear-gradient(0deg, #667eea 0%, #764ba2 100%) border-box;
    -webkit-mask:
      linear-gradient(#fff 0 0) padding-box,
      linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
    clip-path: polygon(0% 0%, 0% 0%, 0% 0%, 0% 0%);
    transition: clip-path 0.6s ease;
    pointer-events: none;
  }

  .nav-link:hover::before {
    clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%);
  }
</style>
